<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Promille-estimator</title>
  <style>
    :root{--bg:#0b1020;--text:#e9eeff;--muted:rgba(233,238,255,.75);--border:rgba(255,255,255,.12);--accent:#7aa2ff;}
    *{box-sizing:border-box}
    body{margin:0;color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background: radial-gradient(1200px 800px at 10% 0%, rgba(122,162,255,0.25), transparent 55%),
                  radial-gradient(900px 700px at 90% 10%, rgba(141,255,181,0.18), transparent 60%),
                  var(--bg);}
    header,main,footer{max-width:980px;margin:0 auto;padding:18px}
    header{padding-top:28px}
    h1{margin:0 0 6px;font-size:clamp(22px,3vw,34px)}
    p{margin:0;color:var(--muted);line-height:1.35}
    .card{margin-top:14px;
      background:linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      border:1px solid var(--border);border-radius:16px;padding:16px;
      box-shadow:0 12px 40px rgba(0,0,0,.35);backdrop-filter: blur(6px);}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:740px){.row{grid-template-columns:1fr}}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input,select,button{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);
      background:rgba(0,0,0,.20);color:var(--text);outline:none}
    input:focus,select:focus{border-color:rgba(122,162,255,.65);box-shadow:0 0 0 4px rgba(122,162,255,.12)}
    button{cursor:pointer;background:linear-gradient(180deg, rgba(122,162,255,.85), rgba(122,162,255,.55));
      border:1px solid rgba(122,162,255,.65);font-weight:800}
    .metric{margin-top:12px;border:1px solid var(--border);border-radius:14px;padding:12px;background:rgba(0,0,0,.18)}
    .k{font-size:12px;color:rgba(233,238,255,.72);margin-bottom:4px}
    .v{font-size:22px;font-weight:900}
    .hint{font-size:12px;color:rgba(233,238,255,.70);line-height:1.35;margin-top:10px}
    .warn{margin-top:10px;padding:10px 12px;border-radius:12px;font-size:12px;
      background:linear-gradient(180deg, rgba(255,211,122,0.22), rgba(0,0,0,0.18));
      border:1px solid rgba(255,211,122,0.35); color:rgba(233,238,255,0.85)}
    a{color:var(--accent);text-decoration:none}
    code{background:rgba(255,255,255,.06); padding:2px 6px; border-radius:8px; border:1px solid var(--border)}
  </style>
</head>
<body>
<header>
  <h1>üß† Promille-estimator</h1>
  <p>En *grov* uppskattning med Widmark-ish modell. Bra f√∂r nyfikenhet. Inte bra f√∂r ‚Äúska jag k√∂ra?‚Äù (Svar: nej.)</p>
</header>

<main>
  <div class="card">
    <h2 style="margin:0 0 10px;font-size:18px;">Profil</h2>
    <div class="row">
      <div>
        <label for="sex">K√∂n</label>
        <select id="sex">
          <option value="male">Man</option>
          <option value="female">Kvinna</option>
        </select>
      </div>
      <div>
        <label for="weight">Vikt (kg)</label>
        <input id="weight" type="number" min="0" step="0.1" value="80"/>
      </div>
    </div>

    <div class="row" style="margin-top:10px;">
      <div>
        <label for="age">√Ölder (√•r)</label>
        <input id="age" type="number" min="0" step="1" value="35"/>
      </div>
      <div>
        <label for="hours">Timmar sedan f√∂rsta drinken</label>
        <input id="hours" type="number" min="0" step="0.1" value="2"/>
      </div>
    </div>

    <h2 style="margin:14px 0 10px;font-size:18px;">Intag</h2>
    <div class="row">
      <div>
        <label for="beerCount">√ñl ‚Äì antal</label>
        <input id="beerCount" type="number" min="0" step="1" value="4"/>
      </div>
      <div>
        <label for="beerCl">√ñl ‚Äì volym per st (cl)</label>
        <input id="beerCl" type="number" min="0" step="0.1" value="33"/>
      </div>
    </div>
    <div class="row" style="margin-top:10px;">
      <div>
        <label for="beerAbv">√ñl ‚Äì alkoholhalt (%)</label>
        <input id="beerAbv" type="number" min="0" step="0.1" value="5.0"/>
      </div>
      <div>
        <label for="wineCount">Vin ‚Äì antal glas</label>
        <input id="wineCount" type="number" min="0" step="1" value="0"/>
      </div>
    </div>
    <div class="row" style="margin-top:10px;">
      <div>
        <label for="wineCl">Vin ‚Äì volym per glas (cl)</label>
        <input id="wineCl" type="number" min="0" step="0.1" value="15"/>
      </div>
      <div>
        <label for="wineAbv">Vin ‚Äì alkoholhalt (%)</label>
        <input id="wineAbv" type="number" min="0" step="0.1" value="12"/>
      </div>
    </div>
    <div class="row" style="margin-top:10px;">
      <div>
        <label for="spiritCount">Sprit ‚Äì antal shots</label>
        <input id="spiritCount" type="number" min="0" step="1" value="0"/>
      </div>
      <div>
        <label for="spiritCl">Sprit ‚Äì volym per shot (cl)</label>
        <input id="spiritCl" type="number" min="0" step="0.1" value="4"/>
      </div>
    </div>
    <div class="row" style="margin-top:10px;">
      <div>
        <label for="spiritAbv">Sprit ‚Äì alkoholhalt (%)</label>
        <input id="spiritAbv" type="number" min="0" step="0.1" value="40"/>
      </div>
      <div style="display:flex;align-items:end;">
        <button id="calc" type="button">R√§kna promille</button>
      </div>
    </div>

    <div class="metric" aria-live="polite">
      <div class="k">Uppskattad promille (‚Ä∞)</div>
      <div class="v" id="bac">‚Äì</div>
      <div class="hint" id="details"></div>
    </div>

    <div class="metric" aria-live="polite">
      <div class="k">Total ren alkohol</div>
      <div class="v" id="grams">‚Äì</div>
      <div class="hint">Vi r√§knar gram alkohol med densitet ~0,789 g/ml.</div>
    </div>

    <div class="warn">
      <b>Viktigt:</b> Detta √§r en grov uppskattning. Mat i magen, tempo, mediciner, kroppssammans√§ttning m.m. kan √§ndra mycket.
      Anv√§nd inte detta f√∂r beslut om bil/k√∂rning/arbete. Om du √§r os√§ker: utg√• fr√•n att du inte ska k√∂ra.
    </div>

    <p class="hint">
      Modell (f√∂renklad Widmark):<br/>
      <code>promille ‚âà (A / (r √ó vikt)) ‚àí (Œ≤ √ó timmar)</code><br/>
      d√§r <code>A</code> = gram alkohol, <code>r</code> ‚âà 0,68 (man) / 0,55 (kvinna).<br/>
      Vi justerar Œ≤ lite med √•lder (mycket grovt): Œ≤ = 0,15 ‚àí 0,001√ómax(0, √•lder‚àí30), klampat till 0,10‚Äì0,20 ‚Ä∞/h.
    </p>

    <p class="hint"><a href="./index.html">‚Üê Till start</a></p>
  </div>
</main>

<footer>
  <p class="hint">Pro-tip: Vatten + mat + s√∂mn sl√•r alla formler. (Tyv√§rr.)</p>
</footer>

<script>
  const $ = (id)=>document.getElementById(id);

  function clamp(x, lo, hi){ return Math.max(lo, Math.min(hi, x)); }
  function num(n,d=2){
    if(!isFinite(n)) return "‚Äì";
    const p = Math.pow(10,d);
    return (Math.round(n*p)/p).toLocaleString("sv-SE",{minimumFractionDigits:d, maximumFractionDigits:d});
  }

  function gramsFrom(count, cl, abv){
    const density = 0.789;
    const ml = (count||0) * (cl||0) * 10.0;
    const ethanolMl = ml * ((abv||0)/100.0);
    return ethanolMl * density;
  }

  function calc(){
    const sex = $("sex").value;
    const weight = +$("weight").value || 0;
    const age = +$("age").value || 0;
    const hours = +$("hours").value || 0;

    const beerG = gramsFrom(+$("beerCount").value, +$("beerCl").value, +$("beerAbv").value);
    const wineG = gramsFrom(+$("wineCount").value, +$("wineCl").value, +$("wineAbv").value);
    const spiritG = gramsFrom(+$("spiritCount").value, +$("spiritCl").value, +$("spiritAbv").value);

    const A = beerG + wineG + spiritG;

    const r = (sex === "male") ? 0.68 : 0.55;

    let beta = 0.15 - Math.max(0, age - 30) * 0.001;
    beta = clamp(beta, 0.10, 0.20);

    let bac = (weight > 0) ? (A / (r * weight)) : NaN;
    bac = bac - beta * hours;
    bac = Math.max(0, bac);

    $("bac").textContent = num(bac, 2);
    $("grams").textContent = `${num(A, 1)} g`;
    $("details").textContent = `A=${num(A,1)} g, r=${r.toFixed(2)}, Œ≤=${beta.toFixed(2)} ‚Ä∞/h, tid=${num(hours,1)} h.`;
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    $("calc").addEventListener("click", calc);
    [
      "sex","weight","age","hours",
      "beerCount","beerCl","beerAbv",
      "wineCount","wineCl","wineAbv",
      "spiritCount","spiritCl","spiritAbv"
    ].forEach(id => $(id).addEventListener("input", calc));
    calc();
  });
</script>
</body>
</html>
